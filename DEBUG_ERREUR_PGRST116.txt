â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ DEBUG ERREUR PGRST116 - "Cannot coerce result to single JSON object"
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Cette erreur signifie que la requÃªte ne retourne AUCUNE ligne (0 rows).
Cela peut Ãªtre dÃ» Ã :
1. Le devis n'existe pas
2. Les RLS policies bloquent l'accÃ¨s
3. Mauvais ID de devis

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… SOLUTION RAPIDE - 2 Ã‰TAPES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ã‰TAPE 1: CORRIGER LE CODE (DÃ‰JÃ€ FAIT)
--------------------------------------
âœ… J'ai modifiÃ© SignerContratPage.tsx pour utiliser maybeSingle()
âœ… Cela Ã©vite l'erreur et affiche un message clair si le devis n'existe pas

Ã‰TAPE 2: CORRIGER LES RLS POLICIES
-----------------------------------
ğŸ‘‰ ExÃ©cutez ce script dans Supabase SQL Editor:
   FIX_ACCES_DEVIS_CONTRAT.sql

Ce script va:
âœ… CrÃ©er les bonnes policies pour que les clients puissent lire leurs devis
âœ… CrÃ©er les policies pour que les clients puissent crÃ©er/modifier des contrats
âœ… Permettre aux prestataires de voir leurs contrats aussi

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” VÃ‰RIFIER QUEL EST LE PROBLÃˆME EXACT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Dans Supabase SQL Editor, exÃ©cutez:

-- 1. VÃ©rifier que le devis existe
SELECT id, numero, statut, client_id, prestataire_id
FROM devis_pro
WHERE id = 'e68ca997-ed77-4b0e-8ab8-e970ed989a78';

-- Si Ã§a retourne 0 lignes â†’ Le devis n'existe pas
-- Si Ã§a retourne 1 ligne â†’ Le devis existe, c'est un problÃ¨me de RLS

-- 2. VÃ©rifier votre client_id
SELECT id, user_id, full_name
FROM clients
WHERE user_id = auth.uid();

-- Notez votre client_id

-- 3. VÃ©rifier que le devis appartient bien Ã  ce client
SELECT 
  d.id,
  d.numero,
  d.client_id,
  c.full_name as client_name,
  c.user_id
FROM devis_pro d
JOIN clients c ON d.client_id = c.id
WHERE d.id = 'e68ca997-ed77-4b0e-8ab8-e970ed989a78';

-- Si le client_id ne correspond pas â†’ Le devis n'est pas pour vous
-- Si Ã§a correspond â†’ C'est un problÃ¨me de RLS policies

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš€ APRÃˆS AVOIR EXÃ‰CUTÃ‰ LE FIX
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. RafraÃ®chissez la page de l'application (F5)
2. Cliquez Ã  nouveau sur "Voir le contrat"
3. Ã‡a devrait fonctionner maintenant!

RÃ‰SULTAT ATTENDU:
âœ… La page de signature s'affiche
âœ… Le contrat est crÃ©Ã© automatiquement
âœ… Vous voyez le contenu HTML du contrat
âœ… Vous pouvez signer

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ SI Ã‡A NE MARCHE TOUJOURS PAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ouvrez la console du navigateur (F12) et regardez:
1. L'onglet "Network" pour voir quelle requÃªte Ã©choue
2. L'onglet "Console" pour voir les erreurs JavaScript

Copiez-moi:
- L'URL de la requÃªte qui Ã©choue
- Le message d'erreur complet
- Le devis_id que vous essayez d'ouvrir

Je corrigerai immÃ©diatement!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ CHECKLIST DE DÃ‰BOGAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â˜ Code modifiÃ© (maybeSingle) - FAIT âœ…
â˜ Script FIX_ACCES_DEVIS_CONTRAT.sql exÃ©cutÃ©
â˜ Page rafraÃ®chie (F5)
â˜ RÃ©essayÃ© de cliquer sur "Voir le contrat"

Si tout est cochÃ© et Ã§a ne marche pas â†’ Dites-moi!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
