â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… FLUX FINAL - CRÃ‰ATION DU CONTRAT AU CLIC SUR "VOIR LE CONTRAT"
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ NOUVEAU COMPORTEMENT
------------------------
Le contrat est maintenant crÃ©Ã© UNIQUEMENT quand le client clique sur
le bouton "Voir le contrat", pas lors de l'acceptation du devis.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ FLUX COMPLET Ã‰TAPE PAR Ã‰TAPE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ã‰TAPE 1: CLIENT ACCEPTE LE DEVIS
---------------------------------
Page: AccepterDevisPage.tsx

Actions:
1. Client coche les deux cases (conditions + paiement)
2. Client clique "Accepter et continuer"
3. Mise Ã  jour du devis:
   - statut â†’ 'accepte'
   - date_acceptation â†’ maintenant
4. Message: "Devis acceptÃ© avec succÃ¨s! Cliquez sur 'Voir le contrat' pour continuer."
5. Rechargement de la page
6. Affichage du bouton "Voir le contrat" (devis acceptÃ©)

âŒ PAS de crÃ©ation de contrat Ã  cette Ã©tape
âŒ PAS de redirection automatique

Ã‰TAPE 2: CLIENT CLIQUE "VOIR LE CONTRAT"
-----------------------------------------
Bouton disponible sur:
- AccepterDevisPage.tsx (si devis dÃ©jÃ  acceptÃ©)
- DemandeDetailPage.tsx (liste des devis acceptÃ©s)
- DemandesPage.tsx (onglet "Devis acceptÃ©s")

Action:
â†’ Redirection vers: /dashboard/client/contrat/:devisId

Ã‰TAPE 3: GÃ‰NÃ‰RATION DU CONTRAT
-------------------------------
Page: SignerContratPage.tsx

Actions automatiques:
1. Chargement du devis
2. Recherche du contrat existant (maybeSingle)
3. SI contrat n'existe pas:
   âœ… GÃ©nÃ©ration du numÃ©ro (CTR-timestamp)
   âœ… GÃ©nÃ©ration du contenu HTML
   âœ… Calcul des montants (30/70)
   âœ… Insertion dans la table contrats
   âœ… Message: "Contrat gÃ©nÃ©rÃ© avec succÃ¨s!"
4. SI contrat existe dÃ©jÃ :
   âœ… Chargement direct
5. Affichage de la page de signature

Ã‰TAPE 4: CLIENT SIGNE LE CONTRAT
---------------------------------
Page: SignerContratPage.tsx

Actions:
1. Client dessine sa signature
2. Client clique "Signer et continuer"
3. Upload de la signature dans le bucket 'signatures'
4. Mise Ã  jour du contrat:
   - signature_client_url â†’ URL de la signature
   - date_signature_client â†’ maintenant
   - statut â†’ 'signe_client'
5. Redirection vers: /dashboard/client/paiement/:contratId/acompte

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”„ AVANTAGES DE CE FLUX
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… CrÃ©ation Ã  la demande (lazy loading)
âœ… Pas de contrat crÃ©Ã© inutilement
âœ… Le client contrÃ´le quand voir le contrat
âœ… Pas de redirection forcÃ©e aprÃ¨s acceptation
âœ… Le client peut accepter plusieurs devis avant de voir les contrats
âœ… GÃ©nÃ©ration instantanÃ©e au moment du clic
âœ… Pas de dÃ©pendance Ã  un trigger SQL

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ FICHIERS MODIFIÃ‰S
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. AccepterDevisPage.tsx
   - SupprimÃ© la crÃ©ation du contrat
   - SupprimÃ© la redirection automatique
   - AjoutÃ© rechargement pour afficher le bouton
   - Message mis Ã  jour

2. SignerContratPage.tsx (dÃ©jÃ  configurÃ©)
   - CrÃ©ation automatique si contrat n'existe pas
   - Utilise maybeSingle() pour Ã©viter les erreurs
   - Gestion complÃ¨te de la gÃ©nÃ©ration

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ§ª TESTER LE NOUVEAU FLUX
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. RafraÃ®chir l'application (F5)

2. Accepter un devis:
   - Aller sur une demande
   - Cliquer "Accepter" sur un devis
   - Cocher les deux cases
   - Cliquer "Accepter et continuer"
   - âœ… Message: "Devis acceptÃ© avec succÃ¨s! Cliquez sur 'Voir le contrat'..."
   - âœ… Bouton "Voir le contrat" apparaÃ®t

3. Voir le contrat:
   - Cliquer sur "Voir le contrat"
   - âœ… Redirection vers la page de signature
   - âœ… Message: "Contrat gÃ©nÃ©rÃ© avec succÃ¨s!" (si nouveau)
   - âœ… Contrat affichÃ© immÃ©diatement
   - âœ… Zone de signature disponible

4. Signer:
   - Dessiner la signature
   - Cliquer "Signer et continuer"
   - âœ… Redirection vers le paiement

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¡ COMPORTEMENTS SPÃ‰CIAUX
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CAS 1: Devis dÃ©jÃ  acceptÃ©
â†’ Le bouton "Voir le contrat" est visible immÃ©diatement
â†’ Cliquer dessus gÃ©nÃ¨re le contrat

CAS 2: Contrat dÃ©jÃ  crÃ©Ã©
â†’ Pas de rÃ©gÃ©nÃ©ration
â†’ Affichage direct du contrat existant

CAS 3: Plusieurs devis acceptÃ©s
â†’ Chaque devis a son bouton "Voir le contrat"
â†’ Les contrats sont crÃ©Ã©s indÃ©pendamment

CAS 4: Erreur de crÃ©ation
â†’ Message d'erreur affichÃ©
â†’ Le client peut rÃ©essayer

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š RÃ‰SUMÃ‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

AVANT (version prÃ©cÃ©dente):
- Acceptation â†’ CrÃ©ation immÃ©diate â†’ Redirection

MAINTENANT:
- Acceptation â†’ Affichage bouton
- Clic "Voir le contrat" â†’ CrÃ©ation â†’ Affichage

AVANTAGE:
âœ… Plus de contrÃ´le pour le client
âœ… CrÃ©ation Ã  la demande
âœ… Pas de contrats inutiles

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
