ğŸ”´ ERREUR LORS DU PAIEMENT
==========================

Erreur rencontrÃ©e :
POST /rest/v1/rpc/generate_paiement_numero
Status: 400 Bad Request
Error: "column reference 'numero' is ambiguous"


ğŸ” CAUSE DU PROBLÃˆME
--------------------

La fonction SQL `generate_paiement_numero()` a une rÃ©fÃ©rence ambiguÃ«.
Dans la requÃªte SQL, la colonne "numero" peut faire rÃ©fÃ©rence Ã  :
1. La colonne de la table "paiements"
2. La variable locale "numero"

PostgreSQL ne sait pas laquelle utiliser â†’ Erreur


âœ… SOLUTION
-----------

ExÃ©cuter le fichier SQL suivant dans Supabase SQL Editor :

ğŸ“ Fichier : FIX_TOUTES_FONCTIONS_NUMERO.sql


ğŸš€ COMMENT EXÃ‰CUTER
-------------------

1. Ouvrez Supabase Dashboard
   https://supabase.com/dashboard

2. Allez dans votre projet KaziPro

3. Cliquez sur "SQL Editor" dans le menu de gauche

4. Cliquez sur "New query"

5. Copiez TOUT le contenu du fichier :
   FIX_TOUTES_FONCTIONS_NUMERO.sql

6. Collez dans l'Ã©diteur SQL

7. Cliquez sur "Run" (ou Ctrl+Enter)

8. Vous devriez voir :
   âœ… Toutes les fonctions ont Ã©tÃ© corrigÃ©es avec succÃ¨s!
   ğŸ“‹ Tests des fonctions:
      - generate_contrat_numero() â†’ CONT-2026-0001
      - generate_paiement_numero() â†’ PAY-2026-0001
      - generate_litige_numero() â†’ LIT-2026-0001


ğŸ“ CE QUI EST CORRIGÃ‰
---------------------

3 fonctions sont corrigÃ©es :

1. generate_contrat_numero()
   Avant : WHERE numero LIKE...
   AprÃ¨s : WHERE contrats.numero LIKE...

2. generate_paiement_numero()
   Avant : WHERE numero LIKE...
   AprÃ¨s : WHERE paiements.numero LIKE...

3. generate_litige_numero()
   Avant : WHERE numero LIKE...
   AprÃ¨s : WHERE litiges.numero LIKE...


ğŸ§ª APRÃˆS L'EXÃ‰CUTION
--------------------

1. Retournez sur votre application

2. Allez sur la page de paiement

3. Cliquez sur "Payer"

4. â†’ Le paiement devrait maintenant fonctionner !


âš ï¸ IMPORTANT
------------

Ce fix corrige TOUTES les fonctions de gÃ©nÃ©ration de numÃ©ro.
Vous n'aurez plus ce problÃ¨me pour :
- Les contrats
- Les paiements
- Les litiges


âœ… STATUT
---------

Une fois le SQL exÃ©cutÃ© :
âœ… Fonction generate_paiement_numero() corrigÃ©e
âœ… Fonction generate_contrat_numero() corrigÃ©e
âœ… Fonction generate_litige_numero() corrigÃ©e
âœ… Paiement fonctionnel


ğŸ“ SI Ã‡A NE MARCHE PAS
----------------------

VÃ©rifiez que :
1. Le SQL s'est exÃ©cutÃ© sans erreur
2. Vous voyez les messages de confirmation
3. Vous avez rafraÃ®chi la page de l'application

Si le problÃ¨me persiste, partagez le message d'erreur complet.
