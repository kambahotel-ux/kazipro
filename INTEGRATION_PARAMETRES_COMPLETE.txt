â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… INTÃ‰GRATION DANS PARAMÃˆTRES - TERMINÃ‰E
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Date: 27 janvier 2025
Statut: âœ… TerminÃ©

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ CE QUI A Ã‰TÃ‰ FAIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. âœ… CrÃ©Ã© un script SQL pour fixer les RLS
   â†’ FIX_RLS_PRESTATAIRE_CONFIG.sql
   â†’ Permet INSERT/UPDATE pour les prestataires

2. âœ… CrÃ©Ã© un composant rÃ©utilisable
   â†’ src/components/prestataire/ConfigPaiementTab.tsx
   â†’ Contient les 2 configurations avec sous-onglets

3. âœ… IntÃ©grÃ© dans la page ParamÃ¨tres
   â†’ Remplace l'ancien contenu de l'onglet "Paiements"
   â†’ Accessible via: /dashboard/prestataire/parametres

4. âœ… NettoyÃ© la sidebar
   â†’ SupprimÃ© les liens directs (config-paiement, frais-deplacement)
   â†’ Tout est maintenant dans ParamÃ¨tres

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ FICHIERS CRÃ‰Ã‰S/MODIFIÃ‰S
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CRÃ‰Ã‰S:
â”€â”€â”€â”€â”€â”€
1. FIX_RLS_PRESTATAIRE_CONFIG.sql
   â†’ Script SQL pour fixer les policies RLS
   â†’ Permet aux prestataires d'insÃ©rer/modifier leur config

2. src/components/prestataire/ConfigPaiementTab.tsx
   â†’ Composant avec 2 sous-onglets:
     - Configuration Paiement
     - Frais de DÃ©placement
   â†’ RÃ©utilisable et autonome

MODIFIÃ‰S:
â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. src/pages/dashboard/prestataire/ParametresPage.tsx
   â†’ Import de ConfigPaiementTab
   â†’ Remplacement du contenu de l'onglet "payments"

2. src/components/dashboard/DashboardSidebar.tsx
   â†’ Suppression des liens "Config Paiement" et "Frais dÃ©placement"
   â†’ Retour Ã  la sidebar originale

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ STRUCTURE DE LA PAGE PARAMÃˆTRES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/dashboard/prestataire/parametres

Onglets principaux:
â”œâ”€â”€ Entreprise (company)
â”œâ”€â”€ Notifications (notifications)
â”œâ”€â”€ SÃ©curitÃ© (security)
â”œâ”€â”€ Paiements (payments) â­ MODIFIÃ‰
â”‚   â”œâ”€â”€ Configuration Paiement
â”‚   â”‚   â”œâ”€â”€ Activation KaziPro
â”‚   â”‚   â”œâ”€â”€ Choix des Ã©lÃ©ments
â”‚   â”‚   â””â”€â”€ Bouton Enregistrer
â”‚   â””â”€â”€ Frais de DÃ©placement
â”‚       â”œâ”€â”€ Activation
â”‚       â”œâ”€â”€ Mode de calcul (fixe/km/zone/gratuit)
â”‚       â”œâ”€â”€ Configuration selon le mode
â”‚       â””â”€â”€ Bouton Enregistrer
â”œâ”€â”€ DisponibilitÃ© (availability)
â””â”€â”€ PrÃ©fÃ©rences (preferences)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” ERREURS RLS CORRIGÃ‰ES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

AVANT:
âŒ POST /configuration_paiement_prestataire â†’ 403 Forbidden
âŒ POST /frais_deplacement_config â†’ 403 Forbidden

APRÃˆS (avec FIX_RLS_PRESTATAIRE_CONFIG.sql):
âœ… Les prestataires peuvent INSERT leur config
âœ… Les prestataires peuvent UPDATE leur config
âœ… Les prestataires peuvent SELECT leur config

Policies crÃ©Ã©es:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
configuration_paiement_prestataire:
  âœ“ allow_prestataire_select_own_config (SELECT)
  âœ“ allow_prestataire_insert_own_config (INSERT)
  âœ“ allow_prestataire_update_own_config (UPDATE)

frais_deplacement_config:
  âœ“ allow_prestataire_select_own_frais (SELECT)
  âœ“ allow_prestataire_insert_own_frais (INSERT)
  âœ“ allow_prestataire_update_own_frais (UPDATE)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ MARCHE Ã€ SUIVRE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ã‰TAPE 1: ExÃ©cuter le script SQL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Va dans Supabase SQL Editor
2. Copie/colle: FIX_RLS_PRESTATAIRE_CONFIG.sql
3. ExÃ©cute
4. Tu devrais voir:
   âœ… Policies RLS crÃ©Ã©es pour configuration_paiement_prestataire
   âœ… Policies RLS crÃ©Ã©es pour frais_deplacement_config
   âœ… TOUT EST PRÃŠT!

Ã‰TAPE 2: Tester la page
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Connecte-toi en tant que prestataire
2. Va sur: /dashboard/prestataire/parametres
3. Clique sur l'onglet "Paiements"
4. Tu verras 2 sous-onglets:
   - Configuration Paiement
   - Frais de DÃ©placement

Ã‰TAPE 3: Tester Configuration Paiement
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Active/dÃ©sactive le paiement KaziPro
2. Active/dÃ©sactive les Ã©lÃ©ments (travaux, matÃ©riel, dÃ©placement)
3. Clique sur "Enregistrer"
4. Recharge la page â†’ Les valeurs doivent Ãªtre sauvegardÃ©es

Ã‰TAPE 4: Tester Frais de DÃ©placement
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Active les frais
2. Choisis un mode (fixe, par km, par zone, gratuit)
3. Configure selon le mode choisi
4. Clique sur "Enregistrer"
5. Recharge la page â†’ Les valeurs doivent Ãªtre sauvegardÃ©es

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… AVANTAGES DE CETTE APPROCHE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Tout centralisÃ© dans ParamÃ¨tres
âœ“ Sidebar plus propre (moins de liens)
âœ“ Navigation logique (ParamÃ¨tres â†’ Paiements)
âœ“ Composant rÃ©utilisable
âœ“ Pas de routes supplÃ©mentaires
âœ“ CohÃ©rent avec le reste de l'app
âœ“ Facile Ã  maintenir

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” VÃ‰RIFICATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Pas d'erreurs TypeScript
âœ“ Imports corrects
âœ“ Composant autonome
âœ“ Hooks fonctionnels
âœ“ RLS policies crÃ©Ã©es
âœ“ Sidebar nettoyÃ©e
âœ“ Routes inutiles supprimÃ©es (optionnel)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š RÃ‰SUMÃ‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

AVANT:
- 2 pages sÃ©parÃ©es (ConfigPaiementPage, FraisDeplacementPage)
- 2 liens dans la sidebar
- 2 routes (/config-paiement, /frais-deplacement)
- Erreurs RLS 403

APRÃˆS:
- 1 composant intÃ©grÃ© (ConfigPaiementTab)
- 1 onglet dans ParamÃ¨tres
- 0 routes supplÃ©mentaires
- RLS fonctionnel âœ…

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ†˜ SI PROBLÃˆME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Erreur 403 persiste:
â†’ VÃ©rifie que FIX_RLS_PRESTATAIRE_CONFIG.sql a Ã©tÃ© exÃ©cutÃ©
â†’ VÃ©rifie les policies:
  SELECT * FROM pg_policies 
  WHERE tablename IN ('configuration_paiement_prestataire', 'frais_deplacement_config');

Onglet Paiements vide:
â†’ VÃ©rifie l'import de ConfigPaiementTab
â†’ Regarde la console (F12) pour les erreurs

Valeurs ne se sauvegardent pas:
â†’ VÃ©rifie que tu es connectÃ© en tant que prestataire
â†’ VÃ©rifie que user.id correspond Ã  un prestataire_id
â†’ Regarde la console pour les erreurs

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
