â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸš§ PHASE 4 - SUIVI DE LA MISSION (EN COURS)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Date: 27 janvier 2025
Statut: â³ En dÃ©veloppement

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸ“¦ FICHIERS CRÃ‰Ã‰S
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. src/pages/dashboard/client/MissionDetailPage.tsx
   â†’ Page de dÃ©tail de mission cÃ´tÃ© client
   â†’ Route: /dashboard/client/missions/:missionId
   â†’ Affichage des informations de la mission
   â†’ Barre de progression
   â†’ Galerie de photos
   â†’ Messagerie en temps rÃ©el
   â†’ Bouton de validation des travaux

2. src/App.tsx (modifiÃ©)
   â†’ Route ajoutÃ©e pour la page de mission

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸŽ¨ FONCTIONNALITÃ‰S IMPLÃ‰MENTÃ‰ES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Page de dÃ©tail de mission (Client):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Affichage des informations gÃ©nÃ©rales:
  - Prestataire (nom, profession)
  - Date de dÃ©but
  - Montant total
  - Statut de la mission
âœ“ Barre de progression (0-100%)
âœ“ Galerie de photos de progression
âœ“ Messagerie intÃ©grÃ©e:
  - Affichage des messages
  - Envoi de nouveaux messages
  - Distinction client/prestataire
âœ“ Bouton de validation (quand progression = 100%)
âœ“ Redirection vers paiement du solde

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸ”— ROUTES AJOUTÃ‰ES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/dashboard/client/missions/:missionId
â†’ Page de dÃ©tail de mission
â†’ Protected route (authentification requise)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸ“Š Ã€ IMPLÃ‰MENTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CÃ”TÃ‰ PRESTATAIRE:
â–¡ Page de dÃ©tail de mission prestataire
â–¡ Mise Ã  jour de la progression
â–¡ Upload de photos
â–¡ Messagerie
â–¡ Demande de validation finale

BASE DE DONNÃ‰ES:
â–¡ Table photos_mission
â–¡ Colonne progress dans missions
â–¡ Colonne validation_requested_at dans missions
â–¡ RLS policies pour photos_mission

CÃ”TÃ‰ CLIENT:
â–¡ Liste des missions actives
â–¡ Notifications de nouveaux messages
â–¡ Notifications de progression
â–¡ DÃ©claration de litige

PAIEMENT DU SOLDE:
â–¡ Page de paiement du solde
â–¡ MÃªme processus que l'acompte
â–¡ LibÃ©ration des fonds au prestataire

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸŽ¯ FLUX UTILISATEUR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Client paie l'acompte
   â†’ Mission crÃ©Ã©e automatiquement
   â†’ Statut: 'en_cours'

2. Client accÃ¨de Ã  la mission
   â†’ /dashboard/client/missions/:missionId
   â†’ Voit les informations

3. Prestataire met Ã  jour la progression
   â†’ Upload des photos
   â†’ Envoie des messages
   â†’ Met Ã  jour le pourcentage

4. Client suit l'avancement
   â†’ Voit la barre de progression
   â†’ Voit les photos
   â†’ Communique avec le prestataire

5. Prestataire termine (100%)
   â†’ Client reÃ§oit une notification
   â†’ Bouton "Valider" apparaÃ®t

6. Client valide les travaux
   â†’ Statut mission: 'en_validation'
   â†’ Redirection vers paiement du solde

7. Client paie le solde
   â†’ Fonds libÃ©rÃ©s au prestataire
   â†’ Mission terminÃ©e

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸ”§ SCRIPTS SQL NÃ‰CESSAIRES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ã€ crÃ©er:

1. Ajouter colonne progress Ã  missions:
```sql
ALTER TABLE missions 
ADD COLUMN IF NOT EXISTS progress INTEGER DEFAULT 0 CHECK (progress >= 0 AND progress <= 100);

ALTER TABLE missions
ADD COLUMN IF NOT EXISTS validation_requested_at TIMESTAMPTZ;
```

2. CrÃ©er table photos_mission:
```sql
CREATE TABLE IF NOT EXISTS photos_mission (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  mission_id UUID NOT NULL REFERENCES missions(id) ON DELETE CASCADE,
  url TEXT NOT NULL,
  description TEXT,
  uploaded_by UUID NOT NULL,
  uploaded_at TIMESTAMPTZ DEFAULT NOW(),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_photos_mission_mission_id ON photos_mission(mission_id);
```

3. RLS policies pour photos_mission:
```sql
ALTER TABLE photos_mission ENABLE ROW LEVEL SECURITY;

-- SELECT: Client et prestataire de la mission
CREATE POLICY "photos_mission_select_policy" ON photos_mission
FOR SELECT
USING (
  EXISTS (
    SELECT 1 FROM missions
    WHERE missions.id = photos_mission.mission_id
    AND (
      missions.client_id IN (SELECT id FROM clients WHERE user_id = auth.uid())
      OR missions.prestataire_id IN (SELECT id FROM prestataires WHERE user_id = auth.uid())
    )
  )
);

-- INSERT: Prestataire uniquement
CREATE POLICY "photos_mission_insert_policy" ON photos_mission
FOR INSERT
WITH CHECK (
  EXISTS (
    SELECT 1 FROM missions
    JOIN prestataires ON prestataires.id = missions.prestataire_id
    WHERE missions.id = photos_mission.mission_id
    AND prestataires.user_id = auth.uid()
  )
);
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸ“ NOTES TECHNIQUES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Messagerie:
- Utilise la table messages existante
- Temps rÃ©el avec polling (Ã  amÃ©liorer avec subscriptions)
- Distinction visuelle client/prestataire
- Envoi avec Enter (Shift+Enter pour nouvelle ligne)

Photos:
- Table photos_mission Ã  crÃ©er
- Upload vers storage Supabase
- Galerie responsive
- Lightbox Ã  ajouter pour agrandissement

Progression:
- Colonne progress (0-100) dans missions
- Mise Ã  jour par le prestataire uniquement
- Barre de progression visuelle
- Alerte quand 100% atteint

Validation:
- Bouton visible uniquement si progress = 100%
- Confirmation avant validation
- Mise Ã  jour du statut mission
- Redirection automatique vers paiement solde

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ LIMITATIONS ACTUELLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Pas de page prestataire
   â†’ Le prestataire ne peut pas encore mettre Ã  jour

2. Table photos_mission n'existe pas
   â†’ Les photos ne s'affichent pas

3. Colonne progress n'existe pas
   â†’ La barre de progression est Ã  0%

4. Pas de notifications en temps rÃ©el
   â†’ Pas de WebSocket/Subscriptions

5. Pas de paiement du solde
   â†’ La validation redirige vers une page inexistante

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸš€ PROCHAINES ACTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

IMMÃ‰DIAT:
1. CrÃ©er les scripts SQL (colonnes + table)
2. CrÃ©er la page prestataire
3. ImplÃ©menter l'upload de photos
4. ImplÃ©menter la mise Ã  jour de progression

COURT TERME:
5. CrÃ©er la page de paiement du solde
6. ImplÃ©menter les notifications
7. Ajouter le lightbox pour les photos
8. AmÃ©liorer la messagerie (temps rÃ©el)

MOYEN TERME:
9. SystÃ¨me de litiges
10. Ã‰valuations et avis
11. Historique des missions
12. Statistiques

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸŽ‰ RÃ‰SUMÃ‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Page de dÃ©tail de mission crÃ©Ã©e (client)
âœ… Route ajoutÃ©e
âœ… Messagerie fonctionnelle
âœ… Interface de validation prÃ©parÃ©e
â³ Scripts SQL Ã  exÃ©cuter
â³ Page prestataire Ã  crÃ©er
â³ Upload de photos Ã  implÃ©menter
â³ Paiement du solde Ã  crÃ©er

Phase 4 est en cours! La structure de base est en place.
Prochaine Ã©tape: Scripts SQL + Page prestataire ðŸš€

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
