â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… PHASE 2 - SIGNATURE DU CONTRAT (TERMINÃ‰E)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Date: 27 janvier 2025
Statut: âœ… ImplÃ©mentÃ©e

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ FICHIERS CRÃ‰Ã‰S
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. sql/create_trigger_contrat_auto.sql
   â†’ Trigger SQL pour gÃ©nÃ©ration automatique du contrat
   â†’ Se dÃ©clenche quand statut devis = 'accepte'
   â†’ GÃ©nÃ¨re le contenu HTML du contrat
   â†’ InsÃ¨re dans la table contrats

2. src/pages/dashboard/client/SignerContratPage.tsx
   â†’ Page de signature du contrat
   â†’ Route: /dashboard/client/contrat/:devisId
   â†’ Canvas de signature Ã©lectronique
   â†’ Upload de la signature
   â†’ Mise Ã  jour du contrat

3. INSTALLER_SIGNATURE.txt
   â†’ Instructions pour installer react-signature-canvas

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¨ FONCTIONNALITÃ‰S
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Trigger SQL:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ DÃ©tection automatique de l'acceptation du devis
âœ“ RÃ©cupÃ©ration des configs (globale + prestataire)
âœ“ Calcul des pourcentages acompte/solde
âœ“ GÃ©nÃ©ration du numÃ©ro de contrat
âœ“ GÃ©nÃ©ration du contenu HTML:
  - Informations prestataire
  - Informations client
  - Objet du contrat
  - Conditions de paiement
  - DÃ©lais
  - Garantie
  - Litiges
  - Zones de signature
âœ“ Insertion dans la table contrats

Page de signature:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Affichage du contrat HTML
âœ“ Bouton tÃ©lÃ©charger PDF (prÃ©parÃ©)
âœ“ Canvas de signature tactile
âœ“ Bouton effacer la signature
âœ“ Validation de la signature
âœ“ Upload dans Supabase Storage (bucket 'signatures')
âœ“ Mise Ã  jour du contrat:
  - signature_client_url
  - date_signature_client
  - statut â†’ 'signe_client'
âœ“ Redirection vers le paiement de l'acompte

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”— ROUTES AJOUTÃ‰ES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/dashboard/client/contrat/:devisId
â†’ Page de signature du contrat
â†’ Protected route (authentification requise)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ FLUX UTILISATEUR COMPLET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Client accepte le devis
   â†’ /dashboard/client/devis/:devisId/accepter
   â†’ Statut devis â†’ 'accepte'

2. Trigger SQL se dÃ©clenche
   â†’ GÃ©nÃ©ration automatique du contrat
   â†’ Insertion dans la table contrats
   â†’ Statut contrat â†’ 'genere'

3. Client est redirigÃ© vers la signature
   â†’ /dashboard/client/contrat/:devisId
   â†’ Affichage du contrat

4. Client lit et signe le contrat
   â†’ Signature sur le canvas
   â†’ Upload de la signature
   â†’ Statut contrat â†’ 'signe_client'

5. Client est redirigÃ© vers le paiement
   â†’ /dashboard/client/paiement/:contratId/acompte
   â†’ (Ã€ crÃ©er dans Phase 3)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š CONTENU DU CONTRAT GÃ‰NÃ‰RÃ‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Le contrat HTML contient:
âœ“ Titre et numÃ©ro
âœ“ IdentitÃ© du prestataire (nom, email, profession)
âœ“ IdentitÃ© du client (nom, email)
âœ“ Article 1: Objet (rÃ©fÃ©rence au devis, montant)
âœ“ Article 2: Conditions de paiement (acompte/solde)
âœ“ Article 3: DÃ©lais de validation
âœ“ Article 4: Garantie
âœ“ Article 5: Litiges et mÃ©diation
âœ“ Date et lieu
âœ“ Zones de signature (client et prestataire)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ INSTALLATION REQUISE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Package npm:
npm install react-signature-canvas
npm install --save-dev @types/react-signature-canvas

Script SQL:
â†’ ExÃ©cuter: sql/create_trigger_contrat_auto.sql

Bucket Supabase:
â†’ Le bucket 'signatures' doit exister
â†’ CrÃ©Ã© par FIX_PAIEMENTS_ET_INSTALLER.sql

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… VÃ‰RIFICATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Trigger SQL crÃ©Ã©
âœ“ Page de signature crÃ©Ã©e
âœ“ Route ajoutÃ©e
âœ“ Canvas de signature intÃ©grÃ©
âœ“ Upload vers storage configurÃ©
âœ“ Redirection vers paiement prÃ©parÃ©e
âœ“ Responsive mobile

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ COMMENT TESTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Installe le package:
   npm install react-signature-canvas @types/react-signature-canvas

2. ExÃ©cute le script SQL:
   sql/create_trigger_contrat_auto.sql

3. Accepte un devis:
   â†’ Va sur /dashboard/client/devis/:devisId/accepter
   â†’ Accepte les conditions
   â†’ Clique "Accepter et continuer"

4. Tu es redirigÃ© vers /dashboard/client/contrat/:devisId

5. Tu vois:
   - Le contrat gÃ©nÃ©rÃ© automatiquement
   - Le canvas de signature
   - Le bouton "Signer et continuer"

6. Signe le contrat:
   - Dessine ta signature sur le canvas
   - Clique "Signer et continuer"

7. La signature est uploadÃ©e

8. Tu es redirigÃ© vers /dashboard/client/paiement/:contratId/acompte
   (Page Ã  crÃ©er dans Phase 3)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš€ PROCHAINE PHASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Phase 3: Paiement de l'acompte
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ Page de paiement
â–¡ Choix de la mÃ©thode (M-Pesa, Airtel Money, etc.)
â–¡ Formulaire de paiement
â–¡ IntÃ©gration API de paiement
â–¡ Confirmation et reÃ§u
â–¡ CrÃ©ation de la mission
â–¡ Notification au prestataire

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ NOTES TECHNIQUES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Trigger SQL:
- Se dÃ©clenche sur UPDATE de devis_pro
- VÃ©rifie le changement de statut vers 'accepte'
- Utilise la fonction generate_contrat_numero()
- RÃ©cupÃ¨re les configs pour les pourcentages
- GÃ©nÃ¨re un HTML formatÃ© et stylisÃ©

Canvas de signature:
- BibliothÃ¨que: react-signature-canvas
- Tactile et souris supportÃ©s
- Export en base64 puis conversion en blob
- Upload dans le bucket 'signatures'
- URL publique stockÃ©e dans le contrat

SÃ©curitÃ©:
- Signature stockÃ©e de maniÃ¨re permanente
- Date de signature enregistrÃ©e
- Statut du contrat mis Ã  jour
- TraÃ§abilitÃ© complÃ¨te

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ‰ RÃ‰SUMÃ‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… GÃ©nÃ©ration automatique du contrat (trigger SQL)
âœ… Page de signature fonctionnelle
âœ… Upload de signature dans storage
âœ… Mise Ã  jour du contrat
âœ… Redirection vers paiement
âœ… Flux complet acceptation â†’ signature â†’ paiement

La Phase 2 est terminÃ©e! Le client peut maintenant signer le contrat
Ã©lectroniquement aprÃ¨s avoir acceptÃ© le devis.

Prochaine Ã©tape: IntÃ©gration du paiement (M-Pesa, Airtel Money) ğŸ’³

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
