â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… PHASE 3 - PAIEMENT DE L'ACOMPTE (TERMINÃ‰E)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Date: 27 janvier 2025
Statut: âœ… ImplÃ©mentÃ©e (mode simulation)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ FICHIERS CRÃ‰Ã‰S
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. src/pages/dashboard/client/PaiementAcomptePage.tsx
   â†’ Page de paiement de l'acompte
   â†’ Route: /dashboard/client/paiement/:contratId/acompte
   â†’ Choix de la mÃ©thode de paiement
   â†’ Formulaire de paiement
   â†’ CrÃ©ation du paiement et de la mission

2. src/pages/dashboard/client/PaiementConfirmationPage.tsx
   â†’ Page de confirmation de paiement
   â†’ Route: /dashboard/client/paiement/:paiementId/confirmation
   â†’ Affichage des dÃ©tails du paiement
   â†’ Prochaines Ã©tapes
   â†’ TÃ©lÃ©chargement du reÃ§u (prÃ©parÃ©)

3. FIX_RLS_PAIEMENTS.sql
   â†’ Policies RLS pour la table paiements
   â†’ SÃ©curitÃ© client/prestataire/admin
   â†’ Permissions SELECT/INSERT/UPDATE

4. src/App.tsx (modifiÃ©)
   â†’ Routes ajoutÃ©es pour paiement et confirmation

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¨ FONCTIONNALITÃ‰S
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Page de paiement (PaiementAcomptePage):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ RÃ©cupÃ©ration du contrat et du devis
âœ“ Calcul automatique du montant de l'acompte
âœ“ Affichage du rÃ©sumÃ© (prestataire, montant total, acompte)
âœ“ Choix de la mÃ©thode de paiement:
  - M-Pesa (Vodacom)
  - Airtel Money
  - Orange Money
âœ“ Saisie du numÃ©ro de tÃ©lÃ©phone
âœ“ GÃ©nÃ©ration du numÃ©ro de paiement (via RPC)
âœ“ CrÃ©ation de l'enregistrement de paiement
âœ“ Simulation du paiement (2 secondes)
âœ“ Mise Ã  jour du statut (en_cours â†’ valide)
âœ“ CrÃ©ation automatique de la mission
âœ“ Redirection vers la confirmation
âœ“ Alertes de sÃ©curitÃ©
âœ“ Mode simulation clairement indiquÃ©

Page de confirmation (PaiementConfirmationPage):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Affichage du statut (succÃ¨s/en cours)
âœ“ DÃ©tails du paiement:
  - NumÃ©ro de paiement
  - Date
  - Montant
  - MÃ©thode
  - Type (acompte)
  - Statut
  - RÃ©fÃ©rence externe
âœ“ Informations du prestataire
âœ“ Prochaines Ã©tapes:
  - Acompte payÃ© et sÃ©curisÃ©
  - Mission crÃ©Ã©e
  - Suivi des travaux
âœ“ Bouton tÃ©lÃ©charger le reÃ§u (prÃ©parÃ©)
âœ“ Bouton retour au dashboard
âœ“ Email de confirmation (mentionnÃ©)

SÃ©curitÃ© RLS (FIX_RLS_PAIEMENTS.sql):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ SELECT: Client, prestataire et admin peuvent voir leurs paiements
âœ“ INSERT: Client peut crÃ©er ses paiements, admin peut tout crÃ©er
âœ“ UPDATE: Client et admin peuvent modifier
âœ“ Webhooks utilisent le service role (bypass RLS)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”— ROUTES AJOUTÃ‰ES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/dashboard/client/paiement/:contratId/acompte
â†’ Page de paiement de l'acompte
â†’ Protected route (authentification requise)

/dashboard/client/paiement/:paiementId/confirmation
â†’ Page de confirmation de paiement
â†’ Protected route (authentification requise)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ FLUX UTILISATEUR COMPLET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Client signe le contrat
   â†’ /dashboard/client/contrat/:devisId
   â†’ Signature Ã©lectronique
   â†’ Statut contrat â†’ 'signe_client'

2. Client est redirigÃ© vers le paiement
   â†’ /dashboard/client/paiement/:contratId/acompte
   â†’ Affichage du rÃ©sumÃ©

3. Client choisit la mÃ©thode de paiement
   â†’ M-Pesa, Airtel Money ou Orange Money
   â†’ Saisie du numÃ©ro de tÃ©lÃ©phone

4. Client clique "Payer"
   â†’ GÃ©nÃ©ration du numÃ©ro de paiement
   â†’ CrÃ©ation de l'enregistrement (statut: en_cours)
   â†’ Simulation du paiement (2 secondes)
   â†’ Mise Ã  jour du statut (valide)
   â†’ CrÃ©ation de la mission
   â†’ Redirection vers confirmation

5. Client voit la confirmation
   â†’ /dashboard/client/paiement/:paiementId/confirmation
   â†’ DÃ©tails du paiement
   â†’ Prochaines Ã©tapes
   â†’ TÃ©lÃ©chargement du reÃ§u

6. Client retourne au dashboard
   â†’ Peut suivre la mission
   â†’ Peut communiquer avec le prestataire

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ MÃ‰THODES DE PAIEMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Actuellement supportÃ©es (simulation):
âœ“ M-Pesa (Vodacom)
âœ“ Airtel Money
âœ“ Orange Money

Mode de fonctionnement actuel:
â†’ Simulation de 2 secondes
â†’ Paiement automatiquement validÃ©
â†’ RÃ©fÃ©rence externe simulÃ©e (SIM-timestamp)

Ã€ intÃ©grer (production):
â–¡ API M-Pesa (Vodacom)
â–¡ API Airtel Money
â–¡ API Orange Money
â–¡ Webhooks de confirmation
â–¡ Gestion des erreurs de paiement
â–¡ Timeout et retry
â–¡ Notifications SMS

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š DONNÃ‰ES CRÃ‰Ã‰ES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Table paiements:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- numero: GÃ©nÃ©rÃ© automatiquement (PAY-YYYYMMDD-XXXX)
- contrat_id: RÃ©fÃ©rence au contrat
- client_id: ID du client
- prestataire_id: ID du prestataire
- type_paiement: 'acompte'
- montant: CalculÃ© selon le pourcentage
- methode_paiement: 'mpesa', 'airtel_money', 'orange_money'
- statut: 'en_cours' â†’ 'valide'
- date_paiement: Date de validation
- reference_externe: RÃ©fÃ©rence de la transaction
- metadata: NumÃ©ro de tÃ©lÃ©phone, devis_id

Table missions:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- demande_id: RÃ©fÃ©rence Ã  la demande
- devis_id: RÃ©fÃ©rence au devis
- contrat_id: RÃ©fÃ©rence au contrat
- client_id: ID du client
- prestataire_id: ID du prestataire
- status: 'en_cours'
- start_date: Date de dÃ©but
- montant_total: Montant total du devis

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ INSTALLATION REQUISE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Scripts SQL:
â†’ ExÃ©cuter: FIX_RLS_PAIEMENTS.sql

Aucun package npm supplÃ©mentaire requis.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… VÃ‰RIFICATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Page de paiement crÃ©Ã©e
âœ“ Page de confirmation crÃ©Ã©e
âœ“ Routes ajoutÃ©es
âœ“ RLS policies configurÃ©es
âœ“ GÃ©nÃ©ration du numÃ©ro de paiement
âœ“ CrÃ©ation du paiement
âœ“ CrÃ©ation de la mission
âœ“ Redirection fonctionnelle
âœ“ Responsive mobile
âœ“ Mode simulation clairement indiquÃ©

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ COMMENT TESTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. ExÃ©cute le script SQL:
   FIX_RLS_PAIEMENTS.sql

2. Signe un contrat:
   â†’ Va sur /dashboard/client/contrat/:devisId
   â†’ Signe le contrat
   â†’ Clique "Signer et continuer"

3. Tu es redirigÃ© vers /dashboard/client/paiement/:contratId/acompte

4. Tu vois:
   - Le rÃ©sumÃ© du paiement
   - Les mÃ©thodes de paiement
   - Le formulaire

5. Choisis une mÃ©thode:
   - M-Pesa, Airtel Money ou Orange Money
   - Entre un numÃ©ro de tÃ©lÃ©phone

6. Clique "Payer":
   - Simulation de 2 secondes
   - Paiement validÃ©
   - Mission crÃ©Ã©e

7. Tu es redirigÃ© vers /dashboard/client/paiement/:paiementId/confirmation

8. Tu vois:
   - Confirmation de succÃ¨s
   - DÃ©tails du paiement
   - Prochaines Ã©tapes
   - Boutons d'action

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš€ PROCHAINES PHASES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Phase 4: Suivi de la mission
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ Page de dÃ©tail de la mission
â–¡ Upload de photos (prestataire)
â–¡ Commentaires et communication
â–¡ Mise Ã  jour de l'avancement
â–¡ Validation des Ã©tapes
â–¡ Demande de validation finale

Phase 5: Paiement du solde
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ DÃ©clenchement aprÃ¨s validation client
â–¡ Page de paiement du solde
â–¡ MÃªme processus que l'acompte
â–¡ LibÃ©ration des fonds au prestataire
â–¡ GÃ©nÃ©ration du reÃ§u final
â–¡ ClÃ´ture de la mission

Phase 6: Litiges
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ DÃ©claration de litige
â–¡ Formulaire avec description
â–¡ Upload de preuves
â–¡ Notification admin
â–¡ MÃ©diation KaziPro
â–¡ RÃ©solution et remboursement

Phase 7: IntÃ©grations rÃ©elles
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ API M-Pesa (Vodacom)
â–¡ API Airtel Money
â–¡ API Orange Money
â–¡ Webhooks de confirmation
â–¡ GÃ©nÃ©ration de reÃ§us PDF
â–¡ Notifications SMS/Email
â–¡ Gestion des erreurs

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ NOTES TECHNIQUES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Mode simulation:
- Paiement validÃ© automatiquement aprÃ¨s 2 secondes
- RÃ©fÃ©rence externe simulÃ©e (SIM-timestamp)
- Aucune vraie transaction
- IdÃ©al pour le dÃ©veloppement et les tests

Calcul de l'acompte:
- RÃ©cupÃ¨re le pourcentage depuis le contrat
- Calcule: (montant_ttc * pourcentage) / 100
- Arrondit le rÃ©sultat

CrÃ©ation de la mission:
- Automatique aprÃ¨s paiement validÃ©
- Statut initial: 'en_cours'
- Date de dÃ©but: maintenant
- Montant total: montant_ttc du devis

SÃ©curitÃ©:
- RLS policies strictes
- Client ne peut payer que ses contrats
- Prestataire peut voir mais pas crÃ©er
- Admin a tous les droits
- Webhooks utilisent le service role

Responsive:
- Layout adaptatif mobile/desktop
- Boutons empilÃ©s sur mobile
- Grille responsive pour les dÃ©tails
- Touch-friendly

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ LIMITATIONS ACTUELLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Mode simulation uniquement
   â†’ Pas de vraie transaction
   â†’ Pas de vÃ©rification du solde
   â†’ Pas de notification SMS

2. GÃ©nÃ©ration de reÃ§u non implÃ©mentÃ©e
   â†’ Bouton prÃ©sent mais non fonctionnel
   â†’ Ã€ implÃ©menter avec jsPDF ou API externe

3. Notifications non implÃ©mentÃ©es
   â†’ Pas d'email de confirmation
   â†’ Pas de SMS au prestataire
   â†’ Ã€ implÃ©menter avec service externe

4. Gestion d'erreurs basique
   â†’ Pas de retry automatique
   â†’ Pas de timeout configurable
   â†’ Pas de gestion des paiements Ã©chouÃ©s

5. Webhooks non configurÃ©s
   â†’ Pas de callback de paiement
   â†’ Pas de mise Ã  jour asynchrone
   â†’ Ã€ implÃ©menter pour la production

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ‰ RÃ‰SUMÃ‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Page de paiement fonctionnelle (simulation)
âœ… Page de confirmation complÃ¨te
âœ… CrÃ©ation automatique du paiement
âœ… CrÃ©ation automatique de la mission
âœ… RLS policies sÃ©curisÃ©es
âœ… Flux complet testÃ©
âœ… Responsive mobile

La Phase 3 est terminÃ©e! Le client peut maintenant payer l'acompte
aprÃ¨s avoir signÃ© le contrat. Le systÃ¨me crÃ©e automatiquement la
mission et redirige vers une page de confirmation.

Prochaine Ã©tape: Suivi de la mission et paiement du solde ğŸš€

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
